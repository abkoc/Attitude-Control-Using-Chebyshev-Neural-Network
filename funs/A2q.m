function q = A2q(A)
% DCN to quaternion
tol = 1e-3;
q4=sqrt(1+A(1,1)+A(2,2)+A(3,3))/2;
if abs(q4) > tol
    q=[(A(2,3)-A(3,2))/4/q4;...
        (A(3,1)-A(1,3))/4/q4;...
        (A(1,2)-A(2,1))/4/q4;...
        q4];
else
    q1 = sqrt(1+A(1,1)-A(2,2)-A(3,3))/2;
    q2 = sqrt(1-A(1,1)+A(2,2)-A(3,3))/2;
    q3 = sqrt(1-A(1,1)-A(2,2)+A(3,3))/2;
    if abs(q1) > tol
        q=[ q1;...
            (A(1,2)-A(2,1))/4/q1;...
            (A(1,3)-A(3,1))/4/q1;...
            (A(2,3)-A(3,2))/4/q1];
    elseif abs(q2) > tol
        q=[ (A(1,2)-A(2,1))/4/q2;...
            q2;...
            (A(2,3)-A(3,2))/4/q2;...
            (A(3,1)-A(1,3))/4/q2];
    else
        q=[ (A(1,3)-A(3,1))/4/q3;...
            (A(2,3)-A(3,2))/4/q3;...
            q3;...
            (A(1,2)-A(2,1))/4/q3];
    end
end
q = q/norm(q);
end

